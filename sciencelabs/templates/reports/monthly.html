{% extends 'reports/base.html' %}

{% block semester_switch %}{% endblock %}

{% block header %}{% endblock %}

{#TODO: This tab needs another subnav that allows the user to switch between #}
{% block body_content %}
    <div class="form-row">
        <div style="text-align: right;" class="form-group col-md-12">
            {# TODO MAKE SURE TO UPDATE WHEN CONNECTING TO DATABASES #}
            <p>
                {% set dates = [] %}
                {% set year = [] %}
                {% for session in sessions %}
                    {% if ((session.date|string)[5:7]) not in dates %}
                        <p style="display: none;">{{ dates.append((session.date|string)[5:7]) }}</p>
                        <p style="display: none;">{{ year.append((session.date|string)[:5]) }}</p>
                    {% endif %}
                {% endfor %}
            {% for date in dates %}
                {% if date %}
                    <a style="text-decoration: none" class="month-nav" href="{{ url_for('ReportView:month', year=year[loop.index0], month=dates[loop.index0]|int) }}">{{ month[date|int - 1][:3] }}</a>&emsp;&emsp;&emsp;
                {% endif %}
            {% endfor %}
            </p>
        </div>
    </div>

   <div class="custom-default row">
       <div class="col-md-8">
           <form>
               <div class="form-row">
                   <div style="text-align: right;" class="form-group col-md-12">
                       <div class="semester-selector">
                            <div class="btn-group">
                                <form class="form-inline">
                                    <button type="button" class="button-curved btn btn-primary">Set</button>
                                    <select class="custom-select">
                                        {% for semester in semester_list %}
                                            <option value="{{ semester.id }}">{{ semester.term }} {{ semester.year }}</option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </div>
                       </div>
                   </div>
               </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <div class="header card">
                            <div class="card-body btn-group">
                                    {# TODO PUT IN MONTH YEAR #}
                                    <p style="padding: 0px; margin: 0px">Attendance for ***MONTH YEAR***</p>
                                <a href="" style="right: 175px;" class="csv-button  btn btn-primary">CSV Summary Export</a>
                                <a href="" class="csv-button btn btn-primary">CSV Detail Export</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        {# TODO MAKE SURE TO UPDATE WHEN CONNECTING TO DATABASES #}
                        <h4>Schedule Statistics for Closed Sessions during ***MONTH***</h4>
                    </div>
                </div>
                {# TODO FILL TABLE #}
                <table id="closed-table"  class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>Schedule Name</th>
                            <th>DOW</th>
                            <th>Schedule Time</th>
                            <th>Total Attendance</th>
                            <th>% Total</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for schedule in schedule_info %}
                        <tr>
                            <td>{{ schedule.name }}</td>
                            <td>{{ day_abbr[schedule.dayofWeek] }}</td>
                            <td>{{ schedule.startTime|datetimeformat }} - {{ schedule.endTime|datetimeformat }}</td>
                            <td>Attendance</td>
                            <td>% Total</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <div class="form-row">
                    <div class="form-group col-md-12">
                        {# TODO MAKE SURE TO UPDATE WHEN CONNECTING TO DATABASES #}
                        <h4>Session Statistics for ***MONTH***</h4>
                    </div>
                </div>
                {# TODO FILL TABLE #}
                <table id="table"  class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Date</th>
                            <th>DOW</th>
                            <th>Scheduled Time</th>
                            <th>Total Attendance</th>
                            <th>report</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for session in monthly_sessions %}
                        <tr>
                            <td>{{ session.name }}</td>
                            <td>{{ session.date.strftime('%m/%d/%Y') }}</td>
                            <td>{{ day_abbr[(cal.weekday(((session.date|string)[:4])|int, ((session.date|string)[5:7])|int, ((session.date|string)[8:])|int) + 1) % 7] }}</td>
                            <td>{{ session.schedStartTime|datetimeformat }} - {{ session.schedEndTime|datetimeformat }}</td>
                            <td>Total Attendance</td>
                            <td><a href='{{ url_for('ReportView:view_session', session_id=session.id) }}' id="darkblue" class="btn btn-primary">View</a></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </form>
        </div>
        <div class="col-md-4">
            <div class="sub-info card info">
                <div class="card-body">
                    <p class="card-text">
                        This page contains schedule and session statistics for the term and month listed at the top of
                        the page.
                    </p>
                    <p class="card-text">
                        Monthly schedule and session data is <strong>sortable</strong>; click on the arrow next to any
                        column header to sort by the column field.
                    </p>
                    <p class="card-text">
                       To view term data from a different <strong>term</strong>, choose an option from the term menu in
                       the upper right hand corner of the page and press the  <span class="button-labels">Set</span>
                        button.
                    </p>
                    <p class="card-text">
                        <strong>Set Term Warning:</strong><br>
                        Within each section of reports (except cumulative reports), the term can be changed. When
                        logging in to the application, the default term will be the current term. If the term is changed
                        in one reporting section, the newly set term will be maintained across all sections of reports
                        until set to a new term again.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        $.extend($.fn.dataTableExt.oStdClasses, {
            // give some foundation classes to our controls
            sLength: 'large-4 columns ',
            sFilter: 'large-12 columns ',
        });

        $(document).ready( function () {
            var table = $('#closed-table').DataTable( {
                "aaSorting": [],
                "bPaginate": false,
                "bLengthChange": false,
            });

            var table = $('#table').DataTable( {
                "aaSorting": [1, 'asc'],
                "bPaginate": false,
                "bLengthChange": false,
            });
        });
    </script>


{% endblock %}