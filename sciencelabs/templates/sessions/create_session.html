{% extends 'sessions/base.html' %}

{% block header %}
    <div class="header card">
        <div class="card-body">
            <p class="card-text">Create a new session</p>
        </div>
    </div>
{% endblock %}

{% block body_content %}
    <div class="custom-default row">
        <div class="col-md-8">
            <form class="create-session-form" action="{{ url_for('SessionView:create_session_submit') }}" method="post">
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="reservation-preference">Type of Session</label>
                        <div id="reservation-preference">
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadioInline1" class="custom-control-input"
                                       name="reservation-pref" value="reservation-sys" checked>
                                <label class="custom-control-label" for="customRadioInline1">Use Reservation System</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" id="customRadioInline2" class="custom-control-input"
                                       name="reservation-pref" value="non-reservation-sys">
                                <label class="custom-control-label" for="customRadioInline2">Use Non-Reservation System</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="session-name">Name of Session</label>
                        <input type="text" class="form-control chosen-container chosen-format" id="session-name" name="name" required autocomplete="off">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="room-number">Room Number</label>
                        <input type="text" class="form-control chosen-container chosen-format" id="room-number" name="room" autocomplete="off">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="semester-select">Semester</label>
                        <select id="semester-select" class="custom-select chosen-container chosen-format" name="semester-select">
                            {% for semester in session['SEMESTER-LIST'] %}
                                {% if semester['id'] == active_semester.id %}
                                    <option selected value="{{ semester['id'] }}">{{ semester['term'] }} {{ semester['year'] }}</option>
                                {% else %}
                                    <option value="{{ semester['id'] }}">{{ semester['term'] }} {{ semester['year'] }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="session-date">Date (click to select)</label>
                        <input type="text" class="form-control chosen-container chosen-format" id="session-date" name="date" required autocomplete="off">
                    </div>
                    <div class="form-group col-md-4">
                        <label for="scheduled-start">Scheduled Start Time</label>
                        <input type="time" class="form-control chosen-container chosen-format" id="scheduled-start" name="scheduled-start" required>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="scheduled-end">Scheduled End Time</label>
                        <input type="time" class="form-control chosen-container chosen-format" id="scheduled-end" name="scheduled-end" required>
                    </div>
                </div>
                <div class="form-row hide-non-reservation-sys">
                    <div class="form-group col-md-6">
                        <label for="capacity">Session Capacity</label>
                        <input type="number" min="0" class="form-control chosen-container chosen-format" id="capacity" name="capacity" value="0" required>
                    </div>
                    <div class="form-group col-md-6 hide-non-reservation-sys">
                        <label for="zoom-url">Zoom Url</label>
                        <input type="url" class="form-control chosen-container chosen-format" id="zoom-url" name="zoom-url" value="" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="choose-leads">Lead Tutors</label>
                        <select required="required" id="choose-leads" multiple="true" name="choose-leads">
                            {% for lead in lead_list %}
                                <option value="{{ lead.id }}" {{ 'selected' if lead in tutor_names }}>{{ lead.firstName }} {{ lead.lastName }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="choose-tutors">Tutors</label>
                        <select id="choose-tutors" multiple="true" name="choose-tutors">
                            {% for tutor in tutor_list %}
                                <option value="{{ tutor.id }}" {{ 'selected' if tutor in tutor_names }}>{{ tutor.firstName }} {{ tutor.lastName }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="actual-start">Actual Start Time</label>
                        <input type="time" class="form-control chosen-container chosen-format" id="actual-start" name="actual-start">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="actual-end">Actual End Time</label>
                        <input type="time" class="form-control chosen-container chosen-format" id="actual-end" name="actual-end">
                    </div>
                </div>
                {{ macros.select_courses(course_list, [], True) }}
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="comments">Comments</label>
                        <textarea class="form-control chosen-container chosen-comments" id="comments" name="comments"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <label for="anon-students">Anonymous Students</label>
                        <input type="text" class="form-control chosen-container chosen-format" id="anon-students" name="anon-students" value="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <button type="submit" class="btn blue btn-primary" id="create-session">Save</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-4">
            <div class="card info">
                <div class="card-body">
                    <p class="card-text"><strong>NEW FALL 2020!</strong></p>
                    <p class="card-text">
                        <ol>
                            <li>Please be careful when entering rooms. HC 113, hc 113, and HC113 are all different rooms. Spacing and capitalization matter!</li>
                            <li>Use "virtual" (without the quotes) as the room number if you want a session to only be attended virtually. Also enter 0 for the session capacity.</li>
                        </ol>
                    </p>
                    <p class="card-text">This section can be used to create a past or a future session that is separate from
                    those created using the Schedule tab.</p>
                    <p class="card-text">For future sessions, actual start and end times will be left blank.</p>
                    <p class="card-text">For historical sessions, both scheduled and actual start and end times may be set.</p>
                </div>
            </div>
        </div>
    </div>
    <link rel="stylesheet" href="{{ url_for('static', filename='pikaday.css') }}">
    <script src="{{ url_for('static', filename='moment.js') }}"></script>
    <script src="{{ url_for('static', filename='pikaday.js') }}"></script>
    <script src="{{ url_for('static', filename='pikaday.jquery.js') }}"></script>
    <script>
        $(document).ready(function () {
            var picker = new Pikaday({
                field: document.getElementById('session-date'),
                format: 'MM/DD/YYYY'
            });

            $("input[value='non-reservation-sys']").click(function() {
                $("div.hide-non-reservation-sys").hide();
                $("#capacity").prop({'required':false,'type':'text'});
                $("#capacity").val('0');
                $("#zoom-url").prop('required',false);
                $("#zoom-url").val('');
            });
            $("input[value='reservation-sys']").click(function() {
                $("div.hide-non-reservation-sys").show();
                $("#capacity").prop({'required':true,'type':'number'});
                $("#zoom-url").prop('required',true);
            });
        });

        var leads = new SlimSelect({
            select: "#choose-leads",
            placeholder: "Choose lead tutors...",
            closeOnSelect: false
        });

        var tutors = new SlimSelect({
            select: "#choose-tutors",
            placeholder: "Choose tutors...",
            closeOnSelect: false
        });
    </script>
{% endblock %}
