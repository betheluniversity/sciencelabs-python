{% extends 'session/base.html' %}

{% block header %}
    <div class="header card">
        <div class="card-body">
            <p class="card-text">Edit {{ session.name + ' (' + session.date.strftime('%m/%d/%Y') + ')'  }} Information</p>
        </div>
    </div>
{% endblock %}

{% block body_content %}
    <form class="edit-session-form">
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="session-name">Name of Session</label>
                <input type="text" class="form-control" id="session-name"
                       value="{{ session.name + ' (' + session.date.strftime('%m/%d/%Y') + ')'  }}">
            </div>
            <div class="form-group col-md-3">
                <label for="room-number">Room Number</label>
                <input type="text" class="form-control" id="room-number" value="{{ session.room }}">
            </div>
            <div class="form-group col-md-3">
                <label for="">Semester</label>
                <select class="custom-select">
                    {% for semester in semester_list %}
                        <option value="{{ semester.id }}">{{ semester.term }} {{ semester.year }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="session-date">Date (click to select)</label>
                <input type="text" class="form-control" id="session-date" value="{{ session.date.strftime('%m/%d/%Y') }}">
            </div>
            <div class="form-group col-md-4">
                <label for="scheduled-start">Scheduled Start Time</label>
                <input type="time" class="form-control" id="scheduled-start"
                       value="{{ (timedelta_to_time + session.schedStartTime).strftime('%H:%M') }}">
            </div>
            <div class="form-group col-md-4">
                <label for="scheduled-end">Scheduled End Time</label>
                <input type="time" class="form-control" id="scheduled-end"
                       value="{{ (timedelta_to_time + session.schedEndTime).strftime('%H:%M') }}">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="choose-leads">Lead Tutors</label>
                <input type="text" class="form-control" id="choose-leads" placeholder="Choose lead tutors...">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="choose-tutors">Tutors</label>
                <input type="text" class="form-control" id="choose-tutors" placeholder="Choose tutors...">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="actual-start">Actual Start Time</label>
                <input type="time" class="form-control" id="actual-start"
                       value="{{ (timedelta_to_time + session.startTime).strftime('%H:%M') }}">
            </div>
            <div class="form-group col-md-6">
                <label for="actual-end">Actual End Time</label>
                <input type="time" class="form-control" id="actual-end"
                       value="{{ (timedelta_to_time + session.endTime).strftime('%H:%M') }}">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <button type="button" class="btn btn-primary" id="all-courses">Select All Courses</button>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                {% for id, name in app_settings['COURSE_OPTIONS'].items() %}
                    <div class="custom-control custom-checkbox" style="display:inline-block;">
                        <input type="checkbox" class="custom-control-input" id="{{ id }}">
                        <label class="custom-control-label" for="{{ id }}">{{ id }} ({{ name }})</label>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="comments">Comments</label>
                <textarea class="form-control" id="comments">{{ session.comments }}</textarea>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <label for="anon-students">Anonymous Students</label>
                <input type="text" class="form-control" id="anon-students" value="{{ session.anonStudents }}">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-12">
                <button type="button" class="btn btn-primary" id="save-session">Save</button>
            </div>
        </div>
    </form>
    <div class="header card" style="margin-bottom:10px;">
        <div class="card-body">
            <p class="card-text">Edit Student Attendance</p>
        </div>
    </div>
    <button id="student-views" type="button" class="edit btn btn-primary" style="margin-bottom:10px;">View by Course</button>
    <table id="edit-student-table" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <th>Name</th>
            <th>Time In</th>
            <th>Time Out</th>
            <th>Courses</th>
            <th></th>
        </thead>
        <tbody>
            {% for student in session_students %}
                <tr>
                    <td>
                        {{ student.firstName }} {{ student.lastName }}
                    </td>
                    <td>
                        {% if student.timeIn %}
                            {{ (timedelta_to_time + student.timeIn).strftime('%I:%M%p') }}
                        {% else %}
                            ???
                        {% endif %}
                    </td>
                    <td>
                        {% if student.timeOut %}
                            {{ (timedelta_to_time + student.timeOut).strftime('%I:%M%p') }}
                        {% else %}
                            ???
                        {% endif %}
                    </td>
                    <td>
                        <ul>
                            {% set courses = student_courses.get_student_session_courses(session.id, student.id) %}
                            {% for course in courses %}
                                <li>{{ course.dept }}{{ course.course_num }}</li>
                            {% endfor %}
                            {% if student.otherCourse or student.otherCourseName %}
                                <li>{{ student.otherCourseName }}<span class="button-labels">Other</span></li>
                            {% endif %}
                        </ul>
                    </td>
                    <td>
                        <div class="btn-group">
                            <button onclick="location.href='{{ url_for('SessionView:edit_student', student_id=student.id, session_id=session.id) }}'"
                                    type="button" class="edit btn btn-primary">Edit</button>
                            <button type="button" class="delete btn btn-primary">Delete</button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <button onclick="location.href='{{ url_for('SessionView:add_student') }}'" type="button"
            class="edit btn btn-primary">Add a Student</button>
    <button onclick="location.href='{{ url_for('SessionView:add_anonymous') }}'" type="button"
            class="btn btn-primary">Add Anonymous Student</button>
    <div class="header card" style="margin-top:10px;margin-bottom:10px;">
        <div class="card-body">
            <p class="card-text">Edit Tutor Attendance</p>
        </div>
    </div>
    <table id="edit-tutor-table" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <th>Name</th>
            <th>Time In</th>
            <th>Time Out</th>
            <th>Lead</th>
            <th></th>
        </thead>
        <tbody>
            {% for tutor in tutors %}
                <tr>
                    <td>
                        {{ tutor.firstName }} {{ tutor.lastName }}
                    </td>
                    <td>
                        {% if tutor.timeIn %}
                            {{ (timedelta_to_time + tutor.timeIn).strftime('%I:%M%p') }}
                        {% else %}
                             ???
                        {% endif %}
                    </td>
                    <td>
                        {% if tutor.timeOut %}
                            {{ (timedelta_to_time + tutor.timeOut).strftime('%I:%M%p') }}
                        {% else %}
                            ???
                        {% endif %}
                    </td>
                    <td>
                        {% if tutor.lead %}
                            Yes
                        {% else %}
                            No
                        {% endif %}
                    </td>
                    <td>
                        <div class="btn-group">
                            <button onclick="location.href='{{ url_for('SessionView:edit_tutor', tutor_id=tutor.id ,session_id=session.id) }}'"
                                    type="button" class="edit btn btn-primary">Edit</button>
                            <button type="button" class="delete btn btn-primary">Delete</button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <button onclick="location.href='{{ url_for('SessionView:add_tutor') }}'" type="button"
            class="edit btn btn-primary">Add a Tutor</button>

    <link rel="stylesheet" href="{{ url_for('static', filename='pikaday.css') }}">
    <script src="{{ url_for('static', filename='pikaday.js') }}"></script>
    <script src="{{ url_for('static', filename='pikaday.jquery.js') }}"></script>
    <script>
        $(document).ready( function () {

            $.extend($.fn.dataTableExt.oStdClasses, {
                // give some foundation classes to our controls
                sWrapper: 'large-12 columns ',
                sLength: 'large-4 columns ',
                sFilter: 'large-12 columns ',
                sInfo: 'large-4 left ',
                sPaging: 'right ',
                sPageButton: 'button small',
                sPageButtonDisabled: 'disabled',
                sPageButtonActive: 'success'
            });

            var tutorTable = $('#edit-tutor-table').dataTable({
                "order": [[0, 'asc'],[1, 'asc']],
                "bPaginate": false,
                "oLanguage": {
                    "sSearch": "Search:"
                }
            });

            var studentTable = $('#edit-student-table').dataTable({
                "order": [[0, 'asc'],[1, 'asc']],
                "bPaginate": false,
                "oLanguage": {
                    "sSearch": "Search:"
                }
            });

            var picker = new Pikaday({
                field: document.getElementById('session-date')
            });

            $('#all-courses').click(function(){
                if($(this).hasClass('all')){
                    $(this).removeClass('all');
                    $('.custom-control-input').prop('checked', false);
                    $(this).text('Select All Courses');
                }else {
                    $(this).addClass('all');
                    $('.custom-control-input').prop('checked', true);
                    $(this).text('Select No Courses');
                }
            });

        });
    </script>
{% endblock %}